{{define "titulo"}}{{if .EsNuevo}}Añadir{{else}}Editar{{end}} Usuario{{end}}
{{define "contenido"}}
<div class="contenedor-inputs angosto">
    <div class="parrafo">
        <h5>{{if .EsNuevo}}Agregar Nuevo Usuario{{else}}Editar Datos del Usuario{{end}}</h5>
        <form action="{{if .EsNuevo}}/agregar-usuario{{else}}/editar-usuario/{{.Id}}{{end}}" method="post" id="form"
            accept="image/*" enctype="multipart/form-data" autocomplete="off">
            <div>
                <label for="nombre">Nombre Completo(*):</label>
                <input type="text" name="nombre" id="nombre" required="" {{if not
                    .EsNuevo}}value="{{.Usuario.NombreCompleto}}" {{end}}>
            </div>
            {{if ne .Usuario.IdPerfil .PERFIL_ADMIN}}
            <div>
                <label for="perfil">Perfil(*):</label>
                <select name="perfil" required="" id="perfil">
                    <option value=""></option>
                    {{range $key, $perfil := .Perfiles}}
                    {{if ne $key $.PERFIL_ADMIN}}
                    <option value="{{$key}}" {{if eq $.Usuario.IdPerfil $key}}selected="" {{end}}>{{$perfil}}</option>
                    {{end}}
                    {{end}}
                </select>
            </div>
            {{else}}
            <input type="hidden" id="perfil" name="perfil" value="{{.PERFIL_ADMIN}}">
            {{end}}
            <div>
                <label for="username">Nombre en Sistema(*):</label>
                <input type="text" name="username" id="username" required="" {{if not
                    .EsNuevo}}value="{{.Usuario.Username}}" {{end}} autocomplete="off">
            </div>
            {{if .EsNuevo}}
            <div>
                <label for="password">Contraseña(*):</label>
                <input type="text" name="password" id="password" required="" {{if not
                    .EsNuevo}}value="{{.Usuario.Username}}" {{end}}>
            </div>
            {{end}}
            <div>
                <input class="boton-grande" type="submit" name="Guardar" value="Guardar">
            </div>
        </form>
    </div>
</div>
<script>
    const form = document.getElementById('form');
    window.onload = () => {
        form.reset()
    }
    form.addEventListener('submit', function (event) {
        event.preventDefault();
        let formData = new FormData(form);
        fetch(form.action, {
            method: 'POST',
            body: formData
        })
            .then(function (response) {
                if (response.ok) {
                    window.location.href = '/usuarios';
                } else {
                    console.log('Form submission failed');
                }
            })
            .catch(function (error) {
                console.log('Error submitting the form:', error);
            });
    });
</script>
{{end}}